---
title: ""
format:
  html:
    theme: none
    toc: false
    page-layout: full
---

```{=html}
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow: hidden; background-color: white; font-family: Arial, sans-serif;
  }

  /* loader */
  #loader {
    position: fixed; inset: 0; background-color: white;
    display: flex; justify-content: center; align-items: flex-start;
    padding-top: 2rem; z-index: 10;
  }
  #loader img { width: 60vw; max-width: 600px; height: auto; }

  /* iframe */
  iframe { border: none; width: 100vw; height: 100vh; display: block; }
  @media (max-width: 768px) { iframe { height: 100svh; } }

  /* parent locate button (mobile-friendly) */
  .locate-wrap {
    position: fixed; left: 50%; transform: translateX(-50%);
    bottom: 24px; z-index: 30;
  }

  /* fab */
  .fab-container { position: fixed; bottom: 20px; right: 20px; z-index: 20; }
  .fab-button {
    background-color: #edfad9; color: #fff; width: 50px; height: 50px;
    border-radius: 50%; text-align: center; font-size: 24px; line-height: 50px;
    cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: background-color .3s;
  }
  .fab-button:hover { background-color: #452d45; }
  .fab-home {
    display: none; position: absolute; bottom: 60px; right: 5px;
    background: #ecf0f1; color: #634360; padding: 8px 12px; border-radius: 20px;
    font-size: 14px; text-decoration: none; box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    transition: all .3s;
  }
  .fab-home.show { display: inline-block; }
</style>

<!-- loader -->
<div id="loader">
  <img src="https://firebasestorage.googleapis.com/v0/b/fig-1-41cec.firebasestorage.app/o/kifregloader.gif?alt=media" alt="Loading...">
</div>

<!-- iframe (we will optionally reload it with ?lat=&lng=) -->
<iframe
  id="kifFrame"
  src="https://statoberry-kif-registration.share.connect.posit.cloud/"
  allow="geolocation; clipboard-read; clipboard-write"
  referrerpolicy="origin-when-cross-origin"
  loading="eager"
  onload="document.getElementById('loader').style.display='none';">
</iframe>

<!-- fab -->
<div class="fab-container">
  <div class="fab-button" onclick="toggleFAB()">üîô</div>
  <a href="index.html" class="fab-home" id="fabHome" title="Go to home">üè† Home</a>
</div>

<script>
  function toggleFAB() {
    const homeBtn = document.getElementById("fabHome");
    homeBtn.classList.toggle("show");
  }

  // parent-side geolocation -> pass to app via query params
  function parentLocate() {
    if (!navigator.geolocation) {
      alert("Geolocation not supported on this device.");
      return;
    }
    const opts = { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 };
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude.toFixed(6);
        const lng = pos.coords.longitude.toFixed(6);

        // optional: reverse-geocode using browser GeolocationPosition doesn't include address;
        // keep addr empty or pass a placeholder; your Shiny app can reverse-geocode if needed.
        const addr = "";

        const base = "https://statoberry-kif-registration.share.connect.posit.cloud/";
        const bust = Date.now(); // cache-bust
        const url  = `${base}?lat=${lat}&lng=${lng}&addr=${encodeURIComponent(addr)}&_=${bust}`;

        const f = document.getElementById("kifFrame");
        document.getElementById("loader").style.display = "flex"; // show loader while reloading
        f.onload = () => { document.getElementById("loader").style.display = "none"; };
        f.src = url;
      },
      (err) => {
        console.warn("geo error", err);
        alert("Could not get current location: " + err.message +
              "\nTip: enable precise location for this site, and turn off VPN.");
      },
      opts
    );
  }
</script>
```